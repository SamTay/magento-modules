<?php
use BlueAcorn_AddressValidation_Helper_Constants as AddressField;
$first = true;
$_helper = Mage::helper('blueacorn_addressvalidation');
?>
<form id="validated-address-form" method="post" action="#">

    <h2><?php echo $_helper->getConfig("form_title", "design") ?></h2>

    <div class="container validated-addresses">
        <?php foreach($this->getAddresses() as $index => $address): ?>
            <input id="address_<?php echo $index ?>" value="<?php echo $index ?>" type="radio" name="validated_address" class="no-style radio"
                <?php if ($first): echo ' checked="checked"'; $first = false; endif; ?>/>
            <label for="address_<?php echo $index ?>">
                <?php echo $address[AddressField::STREET_LINE_1] ?>
                <?php echo $address[AddressField::STREET_LINE_2] ?>
                <?php echo $address[AddressField::CITY] . ', ' . $address[AddressField::STATE] . ' ' . $address[AddressField::POSTCODE] ?>
            </label>
        <?php endforeach ?>

        <?php if ($originalAddress = $this->getOriginalAddress()): ?>
            <h4><?php echo $this->__("Original Address") ?></h4>

            <input id="address_original" value="original" type="radio" name="validated_address" class="no-style radio original-address" />
            <label for="address_original" class="original-address">
                <?php echo $originalAddress[AddressField::STREET_LINE_1] ?>
                <?php echo $originalAddress[AddressField::STREET_LINE_2] ?>
                <?php if (array_key_exists(AddressField::CITY, $originalAddress) && array_key_exists(AddressField::STATE, $originalAddress)): ?>
                    <?php echo $originalAddress[AddressField::CITY] . ', ' . $originalAddress[AddressField::STATE] . ' ' ?>
                <?php endif ?>
                <?php echo $originalAddress[AddressField::POSTCODE] ?>
            </label>
        <?php endif ?>

    </div>
    <div class="container buttons buttons-set">
        <p class="back-link"><a href="#" class="go-back"><small>&laquo; </small><?php echo $this->__('Back') ?></a></p>
        <button type="button" title="<?php echo $this->__("Update Address"); ?>" class="button btn btn-submit">
            <span>
                <span><?php echo $this->__("Update Address"); ?></span>
            </span>
        </button>
    </div>
</form>

<?php if ($originalAddress): ?>
<script type="text/javascript">
    $('validated-address-form').on('change', '.radio', function(event) {
        if ($$('input.original-address').first().checked) {
            $$('#validated-address-form button.btn-submit').first().update('Continue');
        } else {
            $$('#validated-address-form button.btn-submit').first().update('Update Address');
        }
    });
</script>
<?php endif ?>